openapi: 3.0.0
info:
  title: Client API - React Native
  description: API cho ứng dụng client (React Native) - Quản lý đại lý và nhân viên bán hàng
  version: 2.0.0
servers:
  - url: http://localhost:3000/api/client
    description: Development server
  - url: https://your-domain.com/api/client
    description: Production server

tags:
  - name: Authentication
    description: API xác thực
  - name: Products
    description: API quản lý sản phẩm
  - name: Inventory
    description: API quản lý tồn kho
  - name: Allocation Request
    description: API đặt hàng xe từ Hãng
  - name: Allocation Tracking
    description: API theo dõi xe được phân bổ
  - name: Pricing & Promotion
    description: API giá sỉ, chiết khấu và khuyến mãi
  - name: Orders
    description: API quản lý đơn hàng (bao gồm thông tin khách hàng)

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token từ API đăng nhập. Format: Bearer {token}

  schemas:
    # ========== ORDER SCHEMAS ==========
    OrderItemRequest:
      type: object
      required:
        - productId
        - variantIndex
        - quantity
      properties:
        productId:
          type: string
          description: ID sản phẩm
          example: "673b1111222233334444aaaa"
        variantIndex:
          type: integer
          description: Chỉ số variant
          example: 0
        quantity:
          type: integer
          description: Số lượng
          minimum: 1
          example: 2
        discount:
          type: number
          description: Chiết khấu cho item này (VND)
          default: 0
          example: 5000000

    CreateOrderRequest:
      type: object
      required:
        - customerInfo
        - items
      properties:
        customerInfo:
          type: object
          required:
            - fullName
            - phone
          properties:
            fullName:
              type: string
              description: Tên khách hàng
              example: "Nguyễn Văn An"
            phone:
              type: string
              description: Số điện thoại
              example: "0901234567"
            email:
              type: string
              description: Email (không bắt buộc)
              example: "nguyenvanan@gmail.com"
            address:
              type: string
              description: Địa chỉ (không bắt buộc)
              example: "123 Nguyễn Huệ, Quận 1, TP.HCM"
        items:
          type: array
          description: Danh sách sản phẩm trong đơn hàng
          minItems: 1
          items:
            $ref: '#/components/schemas/OrderItemRequest'
        customerNotes:
          type: string
          description: Ghi chú từ khách hàng
          example: "Khách muốn nhận xe trước Tết"
        paymentMethod:
          type: string
          enum: [cash, bank_transfer, installment, other]
          default: cash
          example: "installment"
        shippingAddress:
          type: object
          description: Địa chỉ giao hàng (nếu khác địa chỉ khách hàng)
          properties:
            fullAddress:
              type: string
              example: "456 Lê Lợi, Phường Bến Thành, Quận 1"
            city:
              type: string
              example: "TP. Hồ Chí Minh"
            district:
              type: string
              example: "Quận 1"
            ward:
              type: string
              example: "Phường Bến Thành"

    OrderListResponse:
      type: object
      properties:
        id:
          type: string
          example: "675c1111222233334444eeee"
        orderNumber:
          type: string
          example: "ORD-20250106-0123"
        customer:
          type: object
          properties:
            fullName:
              type: string
              example: "Nguyễn Văn An"
            phone:
              type: string
              example: "0901234567"
            email:
              type: string
              example: "nguyenvanan@gmail.com"
            address:
              type: string
              example: "123 Nguyễn Huệ, Quận 1, TP.HCM"
        totalItems:
          type: integer
          description: Số loại sản phẩm
          example: 2
        totalQuantity:
          type: integer
          description: Tổng số lượng xe
          example: 3
        subtotal:
          type: number
          description: Tổng tiền chưa chiết khấu
          example: 2100000000
        discountAmount:
          type: number
          description: Tổng chiết khấu
          example: 50000000
        totalAmount:
          type: number
          description: Tổng tiền sau chiết khấu
          example: 2050000000
        status:
          type: string
          enum: [draft, pending, confirmed, processing, delivering, completed, cancelled, refunded]
          example: "pending"
        paymentMethod:
          type: string
          enum: [cash, bank_transfer, installment, other]
          example: "installment"
        orderedAt:
          type: string
          format: date-time
          description: Ngày đặt hàng
          example: "2025-01-06T10:30:00.000Z"
        confirmedAt:
          type: string
          format: date-time
          nullable: true
          example: null
        completedAt:
          type: string
          format: date-time
          nullable: true
          example: null
        cancelledAt:
          type: string
          format: date-time
          nullable: true
          example: null
        createdAt:
          type: string
          format: date-time
          example: "2025-01-06T09:00:00.000Z"

    OrderDetailResponse:
      type: object
      properties:
        id:
          type: string
          example: "675c1111222233334444eeee"
        orderNumber:
          type: string
          example: "ORD-20250106-0123"
        customer:
          type: object
          properties:
            fullName:
              type: string
              example: "Nguyễn Văn An"
            phone:
              type: string
              example: "0901234567"
            email:
              type: string
              example: "nguyenvanan@gmail.com"
            address:
              type: string
              example: "123 Nguyễn Huệ, Phường Bến Nghé, Quận 1, TP. HCM"
        items:
          type: array
          items:
            type: object
            properties:
              productId:
                type: string
                example: "673b1111222233334444aaaa"
              productName:
                type: string
                example: "VinFast VF8"
              productVersion:
                type: string
                example: "2024"
              productImages:
                type: array
                items:
                  type: string
                example: ["https://res.cloudinary.com/.../vf8-1.jpg"]
              variantIndex:
                type: integer
                example: 0
              variantInfo:
                type: object
                nullable: true
                properties:
                  attributeValues:
                    type: array
                    items:
                      type: string
                    example: ["Màu trắng", "Nội thất da nâu"]
                  price:
                    type: number
                    example: 1050000000
              attributeValues:
                type: array
                items:
                  type: string
                example: ["Màu trắng", "Nội thất da nâu"]
              quantity:
                type: integer
                example: 2
              unitPrice:
                type: number
                example: 1050000000
              discount:
                type: number
                example: 5000000
              totalPrice:
                type: number
                example: 2090000000
        subtotal:
          type: number
          example: 2100000000
        discountAmount:
          type: number
          example: 50000000
        taxAmount:
          type: number
          example: 0
        totalAmount:
          type: number
          example: 2050000000
        status:
          type: string
          example: "pending"
        statusHistory:
          type: array
          items:
            type: object
            properties:
              status:
                type: string
                example: "draft"
              changedAt:
                type: string
                format: date-time
                example: "2025-01-06T09:00:00.000Z"
              changedBy:
                type: string
                nullable: true
                example: "675a1234567890abcdef9999"
              notes:
                type: string
                nullable: true
                example: "Tạo đơn hàng"
        paymentMethod:
          type: string
          example: "installment"
        shippingAddress:
          type: object
          nullable: true
          properties:
            fullAddress:
              type: string
              example: "456 Lê Lợi, Phường Bến Thành, Quận 1"
            city:
              type: string
              example: "TP. Hồ Chí Minh"
            district:
              type: string
              example: "Quận 1"
            ward:
              type: string
              example: "Phường Bến Thành"
        customerNotes:
          type: string
          nullable: true
          example: "Khách muốn nhận xe trước Tết"
        dealerNotes:
          type: string
          nullable: true
          example: "Ưu tiên xử lý"
        orderedAt:
          type: string
          format: date-time
          nullable: true
          example: "2025-01-06T10:30:00.000Z"
        confirmedAt:
          type: string
          format: date-time
          nullable: true
          example: null
        completedAt:
          type: string
          format: date-time
          nullable: true
          example: null
        cancelledAt:
          type: string
          format: date-time
          nullable: true
          example: null
        createdBy:
          type: object
          nullable: true
          properties:
            fullName:
              type: string
              example: "Nguyễn Thị B"
            email:
              type: string
              example: "nguyenthib@dealer.com"
        updatedBy:
          type: object
          nullable: true
        createdAt:
          type: string
          format: date-time
          example: "2025-01-06T09:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-01-06T10:30:00.000Z"

    OrderHistoryResponse:
      type: object
      properties:
        orderNumber:
          type: string
          example: "ORD-20250106-0123"
        currentStatus:
          type: string
          example: "confirmed"
        history:
          type: array
          items:
            type: object
            properties:
              status:
                type: string
                example: "draft"
              changedAt:
                type: string
                format: date-time
                example: "2025-01-06T09:00:00.000Z"
              changedBy:
                type: object
                nullable: true
                properties:
                  fullName:
                    type: string
                    example: "Nguyễn Thị B"
                  email:
                    type: string
                    example: "nguyenthib@dealer.com"
              notes:
                type: string
                nullable: true
                example: "Tạo đơn hàng"

    # ========== ALLOCATION REQUEST SCHEMAS ==========
    AllocationRequestCreateRequest:
      type: object
      required:
        - items
        - requestType
      properties:
        items:
          type: array
          description: Danh sách xe cần đặt
          items:
            type: object
            required:
              - productId
              - variantIndex
              - quantity
            properties:
              productId:
                type: string
                example: "673b1111222233334444aaaa"
              variantIndex:
                type: integer
                example: 0
              quantity:
                type: integer
                minimum: 1
                example: 5
              notes:
                type: string
                example: "Cần giao trước Tết"
        requestType:
          type: string
          enum: [urgent, normal, scheduled]
          description: Loại yêu cầu
          example: "urgent"
        priority:
          type: string
          enum: [low, medium, high, urgent]
          example: "high"
        expectedDeliveryDate:
          type: string
          format: date
          description: Ngày giao mong muốn
          example: "2025-02-15"
        reason:
          type: string
          description: Lý do đặt hàng
          example: "Tăng cường tồn kho cho đợt khuyến mãi Tết 2025"
        notes:
          type: string
          description: Ghi chú thêm
          example: "Ưu tiên màu trắng và đỏ"

    AllocationRequestResponse:
      type: object
      properties:
        _id:
          type: string
          example: "674f1111222233334444gggg"
        requestNumber:
          type: string
          example: "AR-20250120-0001"
        dealerId:
          type: string
          example: "673a9876543210fedcba9876"
        items:
          type: array
          items:
            type: object
            properties:
              productId:
                type: string
                example: "673b1111222233334444aaaa"
              variantIndex:
                type: integer
                example: 0
              quantity:
                type: integer
                example: 5
              notes:
                type: string
                example: "Cần giao trước Tết"
        totalQuantity:
          type: integer
          example: 5
        requestType:
          type: string
          example: "urgent"
        priority:
          type: string
          example: "high"
        status:
          type: string
          enum: [draft, submitted, approved, rejected, completed, cancelled]
          example: "draft"
        createdAt:
          type: string
          format: date-time
          example: "2025-01-20T08:00:00.000Z"

    # ========== INVENTORY SCHEMAS ==========
    InventoryResponse:
      type: object
      properties:
        _id:
          type: string
          example: "6750aaaabbbbccccddddeeee"
        dealerId:
          type: string
          example: "673a9876543210fedcba9876"
        productId:
          type: string
          example: "673b1111222233334444aaaa"
        variantIndex:
          type: integer
          example: 0
        stock:
          type: integer
          description: Số lượng có sẵn
          example: 15
        reservedStock:
          type: integer
          description: Số lượng đã đặt chưa xuất
          example: 3
        availableStock:
          type: integer
          description: Số lượng có thể bán (stock - reservedStock)
          example: 12
        product:
          type: object
          description: Thông tin sản phẩm (populated)
          properties:
            _id:
              type: string
              example: "673b1111222233334444aaaa"
            name:
              type: string
              example: "VinFast VF8"
            version:
              type: string
              example: "2024"
            variants:
              type: array
              items:
                type: object
                properties:
                  attributeValue:
                    type: array
                    items:
                      type: string
                    example: ["Màu trắng", "Nội thất da nâu", "Pin 87.7 kWh"]
                  price:
                    type: number
                    example: 1050000000
        lastUpdatedAt:
          type: string
          format: date-time
          example: "2025-01-19T16:20:00.000Z"

    # ========== PRICING SCHEMAS ==========
    PricingResponse:
      type: object
      properties:
        _id:
          type: string
          example: "6751bbbbccccddddeeee1111"
        dealerId:
          type: string
          example: "673a9876543210fedcba9876"
        productId:
          type: string
          example: "673b1111222233334444aaaa"
        variantIndex:
          type: integer
          description: null = áp dụng cho tất cả variants
          example: 0
        wholesalePrice:
          type: number
          description: Giá sỉ (VND)
          example: 980000000
        effectiveDate:
          type: string
          format: date
          example: "2025-01-01"
        expiryDate:
          type: string
          format: date
          example: "2025-03-31"
        status:
          type: string
          enum: [active, inactive]
          example: "active"

    DiscountResponse:
      type: object
      properties:
        _id:
          type: string
          example: "6752ccccddddeeee22223333"
        dealerId:
          type: string
          example: "673a9876543210fedcba9876"
        discountName:
          type: string
          example: "Chiết khấu mua số lượng lớn"
        discountType:
          type: string
          enum: [percentage, fixed_amount]
          example: "percentage"
        discountValue:
          type: number
          description: "Nếu percentage: 5 = 5%, nếu fixed_amount: số tiền VND"
          example: 5
        applyTo:
          type: string
          enum: [all_products, specific_products, product_category]
          example: "all_products"
        minQuantity:
          type: integer
          description: Số lượng tối thiểu
          example: 10
        minAmount:
          type: number
          description: Giá trị đơn hàng tối thiểu (VND)
          example: 5000000000
        effectiveDate:
          type: string
          format: date
          example: "2025-01-01"
        expiryDate:
          type: string
          format: date
          example: "2025-12-31"
        status:
          type: string
          example: "active"

    PromotionResponse:
      type: object
      properties:
        _id:
          type: string
          example: "6753ddddeeee33334444ffff"
        dealerId:
          type: string
          example: "673a9876543210fedcba9876"
        promotionName:
          type: string
          example: "Tặng phụ kiện khi mua VF8"
        promotionType:
          type: string
          enum: [buy_x_get_y, discount_percentage, fixed_discount, free_gift]
          example: "free_gift"
        promotionConfig:
          type: object
          description: Cấu hình tùy theo loại khuyến mãi
          example:
            giftProductId: "6754eeee5555666677778888"
            giftDescription: "Bộ phụ kiện cao cấp VinFast"
        applyTo:
          type: string
          enum: [all_products, specific_products]
          example: "specific_products"
        productIds:
          type: array
          items:
            type: string
          example: ["673b1111222233334444aaaa"]
        startDate:
          type: string
          format: date
          example: "2025-02-01"
        endDate:
          type: string
          format: date
          example: "2025-02-15"
        status:
          type: string
          enum: [active, inactive, expired]
          example: "active"

    CalculatePriceResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            productId:
              type: string
              example: "673b1111222233334444aaaa"
            variantIndex:
              type: integer
              example: 0
            quantity:
              type: integer
              example: 10
            basePrice:
              type: number
              description: Giá sỉ gốc/đơn vị (VND)
              example: 980000000
            subtotal:
              type: number
              description: Tổng trước chiết khấu (VND)
              example: 9800000000
            discounts:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    example: "Chiết khấu mua số lượng lớn"
                  type:
                    type: string
                    example: "percentage"
                  value:
                    type: number
                    example: 5
                  amount:
                    type: number
                    description: Số tiền được giảm (VND)
                    example: 490000000
            totalDiscount:
              type: number
              description: Tổng chiết khấu (VND)
              example: 490000000
            finalPrice:
              type: number
              description: Tổng tiền sau chiết khấu (VND)
              example: 9310000000
            promotions:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    example: "Tặng phụ kiện khi mua VF8"
                  type:
                    type: string
                    example: "free_gift"
                  description:
                    type: string
                    example: "Bộ phụ kiện cao cấp VinFast"

    # ========== COMMON SCHEMAS ==========
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Thao tác thành công"
        data:
          type: object

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Lỗi xảy ra"
        error:
          type: string
          example: "Chi tiết lỗi..."

paths:
  # ========== AUTHENTICATION ==========
  /account/login:
    post:
      tags:
        - Authentication
      summary: Đăng nhập
      description: Đăng nhập cho tài khoản đại lý
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "dealer@vinfast.vn"
                password:
                  type: string
                  format: password
                  example: "Dealer@123"
      responses:
        '200':
          description: Đăng nhập thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "673a1234567890abcdef5678"
                      email:
                        type: string
                        example: "dealer@vinfast.vn"
                      fullName:
                        type: string
                        example: "Nguyễn Văn Dealer"
                      dealerId:
                        type: string
                        example: "673a9876543210fedcba9876"
                      role:
                        type: string
                        example: "Quản lý đại lý"
        '400':
          description: Thiếu thông tin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Sai email hoặc mật khẩu
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Email hoặc mật khẩu không đúng"

  # ========== PRODUCTS ==========
  /products:
    get:
      tags:
        - Products
      summary: Danh sách sản phẩm
      description: Lấy danh sách sản phẩm xe điện (chỉ hiển thị sản phẩm có trong kho đại lý)
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          example: 20
        - name: keyword
          in: query
          schema:
            type: string
          description: Tìm kiếm theo tên xe
          example: "VF8"
        - name: category
          in: query
          schema:
            type: string
          description: Lọc theo danh mục
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          example: "673b1111222233334444aaaa"
                        name:
                          type: string
                          example: "VinFast VF8"
                        version:
                          type: string
                          example: "2024"
                        basePrice:
                          type: number
                          example: 1050000000
                        rangeKm:
                          type: number
                          example: 420
                        batteryKWh:
                          type: number
                          example: 87.7
                        maxPowerHP:
                          type: number
                          example: 402
                        images:
                          type: array
                          items:
                            type: string
                          example: ["https://cdn.example.com/vf8-1.jpg"]
                        variants:
                          type: array
                          items:
                            type: object
                            properties:
                              attributeValue:
                                type: array
                                items:
                                  type: string
                                example: ["Màu trắng", "Nội thất da nâu"]
                              price:
                                type: number
                                example: 1050000000
                              dealerStock:
                                type: integer
                                description: Tồn kho đại lý cho variant này
                                example: 15
                  pagination:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 25
                      page:
                        type: integer
                        example: 1

  /products/{id}:
    get:
      tags:
        - Products
      summary: Chi tiết sản phẩm
      description: Lấy thông tin chi tiết sản phẩm xe
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "673b1111222233334444aaaa"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "673b1111222233334444aaaa"
                      name:
                        type: string
                        example: "VinFast VF8"
                      version:
                        type: string
                        example: "2024"
                      basePrice:
                        type: number
                        example: 1050000000
                      rangeKm:
                        type: number
                        example: 420
                      batteryKWh:
                        type: number
                        example: 87.7
                      maxPowerHP:
                        type: number
                        example: 402
                      content:
                        type: string
                        description: Mô tả chi tiết HTML
                        example: "<p>VinFast VF8 là dòng xe điện cao cấp...</p>"
                      images:
                        type: array
                        items:
                          type: string
                        example: ["https://cdn.example.com/vf8-1.jpg", "https://cdn.example.com/vf8-2.jpg"]
                      attributes:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                              example: "Màu sắc"
                            values:
                              type: array
                              items:
                                type: string
                              example: ["Trắng", "Đen", "Xanh"]
                      variants:
                        type: array
                        items:
                          type: object
                          properties:
                            attributeValue:
                              type: array
                              items:
                                type: string
                              example: ["Màu trắng", "Nội thất da nâu", "Pin 87.7 kWh"]
                            price:
                              type: number
                              example: 1050000000
                            stock:
                              type: integer
                              description: Tồn kho tổng (của hãng)
                              example: 150
                            dealerStock:
                              type: integer
                              description: Tồn kho của đại lý
                              example: 15
        '404':
          description: Không tìm thấy hoặc không có quyền xem
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ========== ALLOCATIONS TRACKING ==========
  /allocations/summary:
    get:
      tags:
        - Allocation Tracking
      summary: Thống kê phân bổ
      description: Thống kê tổng quan về xe được phân bổ cho đại lý
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      totalAllocations:
                        type: integer
                        description: Tổng số lô phân bổ
                        example: 25
                      totalVehicles:
                        type: integer
                        description: Tổng số xe
                        example: 150
                      byStatus:
                        type: object
                        properties:
                          pending:
                            type: integer
                            example: 5
                          allocated:
                            type: integer
                            example: 8
                          shipped:
                            type: integer
                            example: 7
                          delivered:
                            type: integer
                            example: 5
                      byProduct:
                        type: array
                        items:
                          type: object
                          properties:
                            productId:
                              type: string
                              example: "673b1111222233334444aaaa"
                            productName:
                              type: string
                              example: "VinFast VF8"
                            totalQuantity:
                              type: integer
                              example: 80

  /allocations:
    get:
      tags:
        - Allocation Tracking
      summary: Danh sách phân bổ
      description: Xem danh sách xe được phân bổ từ Hãng cho đại lý
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          example: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, allocated, shipped, delivered, cancelled]
          example: "shipped"
        - name: productId
          in: query
          schema:
            type: string
          description: Lọc theo sản phẩm
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          example: "6755aaaa1111222233334444"
                        dealerId:
                          type: string
                          example: "673a9876543210fedcba9876"
                        productId:
                          type: string
                          example: "673b1111222233334444aaaa"
                        variantIndex:
                          type: integer
                          example: 0
                        quantity:
                          type: integer
                          example: 10
                        allocatedQuantity:
                          type: integer
                          description: Số lượng đã có VIN
                          example: 8
                        status:
                          type: string
                          example: "shipped"
                        allocatedAt:
                          type: string
                          format: date-time
                          example: "2025-01-10T10:00:00.000Z"
                        shippedAt:
                          type: string
                          format: date-time
                          example: "2025-01-15T14:30:00.000Z"
                        product:
                          type: object
                          properties:
                            name:
                              type: string
                              example: "VinFast VF8"
                            version:
                              type: string
                              example: "2024"

  /allocations/{id}:
    get:
      tags:
        - Allocation Tracking
      summary: Chi tiết phân bổ
      description: Xem thông tin chi tiết 1 lô phân bổ
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "6755aaaa1111222233334444"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "6755aaaa1111222233334444"
                      dealerId:
                        type: string
                        example: "673a9876543210fedcba9876"
                      productId:
                        type: string
                        example: "673b1111222233334444aaaa"
                      variantIndex:
                        type: integer
                        example: 0
                      quantity:
                        type: integer
                        example: 10
                      allocatedQuantity:
                        type: integer
                        example: 8
                      status:
                        type: string
                        example: "shipped"
                      notes:
                        type: string
                        example: "Giao hàng đợt 1 - Tháng 1/2025"
                      allocatedAt:
                        type: string
                        format: date-time
                        example: "2025-01-10T10:00:00.000Z"
                      shippedAt:
                        type: string
                        format: date-time
                        example: "2025-01-15T14:30:00.000Z"
                      product:
                        type: object
                        description: Thông tin sản phẩm (populated)
                        properties:
                          _id:
                            type: string
                            example: "673b1111222233334444aaaa"
                          name:
                            type: string
                            example: "VinFast VF8"
                          version:
                            type: string
                            example: "2024"
                          variants:
                            type: array
                            items:
                              type: object
                              properties:
                                attributeValue:
                                  type: array
                                  items:
                                    type: string
                                  example: ["Màu trắng", "Nội thất da nâu"]

  /allocations/{id}/vins:
    get:
      tags:
        - Allocation Tracking
      summary: Danh sách VIN
      description: Xem danh sách VIN (số khung) của xe trong lô phân bổ
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của allocation
          example: "6755aaaa1111222233334444"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      allocationId:
                        type: string
                        example: "6755aaaa1111222233334444"
                      totalVins:
                        type: integer
                        example: 8
                      vins:
                        type: array
                        items:
                          type: object
                          properties:
                            vin:
                              type: string
                              description: Số VIN (Vehicle Identification Number)
                              example: "LVSHCAMB1PE123456"
                            notes:
                              type: string
                              example: "Xe màu trắng - Pin mới 100%"
                            createdAt:
                              type: string
                              format: date-time
                              example: "2025-01-10T11:00:00.000Z"
                            createdBy:
                              type: string
                              example: "Admin Nguyễn Văn A"

  # ========== ALLOCATION REQUESTS ==========
  /allocation-requests:
    post:
      tags:
        - Allocation Request
      summary: Tạo yêu cầu đặt hàng xe
      description: Dealer tạo yêu cầu đặt xe từ Hãng (status = "draft")
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Trang hiện tại
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: Số bản ghi mỗi trang
          example: 20
        - name: keyword
          in: query
          schema:
            type: string
          description: Tìm kiếm theo tên, SĐT, email
          example: "Nguyễn Văn"
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
          description: Lọc theo trạng thái
          example: "active"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CustomerResponse'
                  pagination:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 150
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 20
                      totalPages:
                        type: integer
                        example: 8

  /customers/{id}:
    get:
      tags:
        - Customers
      summary: Chi tiết khách hàng
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674a1234567890abcdef1234"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/CustomerResponse'
        '404':
          description: Không tìm thấy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Customers
      summary: Cập nhật khách hàng
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674a1234567890abcdef1234"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fullName:
                  type: string
                  example: "Nguyễn Văn An (Updated)"
                email:
                  type: string
                  example: "newemail@gmail.com"
                address:
                  type: object
                  properties:
                    street:
                      type: string
                      example: "456 Lê Lợi"
                status:
                  type: string
                  enum: [active, inactive]
                  example: "active"
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Cập nhật thông tin khách hàng thành công"
                  data:
                    $ref: '#/components/schemas/CustomerResponse'

    delete:
      tags:
        - Customers
      summary: Xóa khách hàng (soft delete)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674a1234567890abcdef1234"
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xóa khách hàng thành công"

  # ========== TEST DRIVES ==========
  /test-drives:
    post:
      tags:
        - Test Drives
      summary: Đặt lịch lái thử
      description: Tạo lịch hẹn lái thử xe cho khách hàng
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestDriveCreateRequest'
      responses:
        '201':
          description: Đặt lịch thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Đặt lịch lái thử thành công"
                  data:
                    $ref: '#/components/schemas/TestDriveResponse'
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - Test Drives
      summary: Danh sách lịch hẹn lái thử
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          example: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, completed, cancelled, no_show]
          example: "pending"
        - name: customerId
          in: query
          schema:
            type: string
          description: Lọc theo khách hàng
          example: "674a1234567890abcdef1234"
        - name: date
          in: query
          schema:
            type: string
            format: date
          description: Lọc theo ngày hẹn
          example: "2025-02-01"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestDriveResponse'
                  pagination:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 45
                      page:
                        type: integer
                        example: 1

  /test-drives/{id}:
    get:
      tags:
        - Test Drives
      summary: Chi tiết lịch hẹn
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674c5555666677778888dddd"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestDriveResponse'

  /test-drives/{id}/confirm:
    patch:
      tags:
        - Test Drives
      summary: Xác nhận lịch hẹn
      description: Chuyển status từ "pending" sang "confirmed"
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674c5555666677778888dddd"
      responses:
        '200':
          description: Xác nhận thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xác nhận lịch hẹn thành công"
                  data:
                    $ref: '#/components/schemas/TestDriveResponse'

  /test-drives/{id}/complete:
    patch:
      tags:
        - Test Drives
      summary: Hoàn thành lái thử
      description: Chuyển status sang "completed" sau khi khách lái thử xong
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674c5555666677778888dddd"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                feedback:
                  type: string
                  description: Nhận xét của khách sau khi lái thử
                  example: "Khách hài lòng, quan tâm đến việc mua xe"
      responses:
        '200':
          description: Hoàn thành thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Hoàn thành lái thử thành công"

  /test-drives/{id}/cancel:
    patch:
      tags:
        - Test Drives
      summary: Hủy lịch hẹn
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674c5555666677778888dddd"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                cancelReason:
                  type: string
                  description: Lý do hủy
                  example: "Khách đổi lịch"
      responses:
        '200':
          description: Hủy thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Hủy lịch hẹn thành công"

  # ========== CUSTOMER FEEDBACK ==========
  /feedbacks:
    post:
      tags:
        - Customer Feedback
      summary: Gửi phản hồi/khiếu nại
      description: Khách hàng gửi feedback hoặc complaint
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackCreateRequest'
      responses:
        '201':
          description: Gửi phản hồi thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Gửi phản hồi thành công"
                  data:
                    $ref: '#/components/schemas/FeedbackResponse'

    get:
      tags:
        - Customer Feedback
      summary: Danh sách phản hồi
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          example: 20
        - name: type
          in: query
          schema:
            type: string
            enum: [feedback, complaint, inquiry, suggestion]
          example: "complaint"
        - name: status
          in: query
          schema:
            type: string
            enum: [open, in_progress, resolved, closed]
          example: "open"
        - name: priority
          in: query
          schema:
            type: string
            enum: [low, medium, high, urgent]
          example: "high"
        - name: customerId
          in: query
          schema:
            type: string
          example: "674a1234567890abcdef1234"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FeedbackResponse'
                  pagination:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 78

  /feedbacks/{id}:
    get:
      tags:
        - Customer Feedback
      summary: Chi tiết phản hồi
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674e9999aaaabbbbccccffff"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/FeedbackResponse'

  /feedbacks/{id}/reply:
    patch:
      tags:
        - Customer Feedback
      summary: Trả lời phản hồi
      description: Nhân viên trả lời phản hồi của khách hàng
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674e9999aaaabbbbccccffff"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackReplyRequest'
      responses:
        '200':
          description: Trả lời thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Trả lời phản hồi thành công"
                  data:
                    $ref: '#/components/schemas/FeedbackResponse'

  /feedbacks/{id}/resolve:
    patch:
      tags:
        - Customer Feedback
      summary: Giải quyết phản hồi
      description: Đánh dấu phản hồi đã được giải quyết
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674e9999aaaabbbbccccffff"
      responses:
        '200':
          description: Giải quyết thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Giải quyết phản hồi thành công"

  /feedbacks/{id}/close:
    patch:
      tags:
        - Customer Feedback
      summary: Đóng phản hồi
      description: Đóng phản hồi sau khi đã giải quyết hoàn tất
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674e9999aaaabbbbccccffff"
      responses:
        '200':
          description: Đóng thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Đóng phản hồi thành công"

  # ========== ALLOCATION REQUESTS ==========
  /allocation-requests:
    post:
      tags:
        - Allocation Request
      summary: Tạo yêu cầu đặt hàng xe
      description: Dealer tạo yêu cầu đặt xe từ Hãng (status = "draft")
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AllocationRequestCreateRequest'
      responses:
        '201':
          description: Tạo yêu cầu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Tạo yêu cầu đặt hàng thành công"
                  data:
                    $ref: '#/components/schemas/AllocationRequestResponse'

    get:
      tags:
        - Allocation Request
      summary: Danh sách yêu cầu đặt hàng
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          example: 1
        - name: status
          in: query
          schema:
            type: string
            enum: [draft, submitted, approved, rejected, completed, cancelled]
          example: "submitted"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AllocationRequestResponse'

  /allocation-requests/{id}:
    get:
      tags:
        - Allocation Request
      summary: Chi tiết yêu cầu
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674f1111222233334444gggg"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/AllocationRequestResponse'

    patch:
      tags:
        - Allocation Request
      summary: Cập nhật yêu cầu (khi còn ở draft)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674f1111222233334444gggg"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      productId:
                        type: string
                        example: "673b1111222233334444aaaa"
                      variantIndex:
                        type: integer
                        example: 0
                      quantity:
                        type: integer
                        example: 8
                requestType:
                  type: string
                  example: "normal"
      responses:
        '200':
          description: Cập nhật thành công

    delete:
      tags:
        - Allocation Request
      summary: Xóa yêu cầu (soft delete, chỉ khi draft)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674f1111222233334444gggg"
      responses:
        '200':
          description: Xóa thành công

  /allocation-requests/{id}/submit:
    patch:
      tags:
        - Allocation Request
      summary: Gửi yêu cầu (draft → submitted)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674f1111222233334444gggg"
      responses:
        '200':
          description: Gửi yêu cầu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Gửi yêu cầu đặt hàng thành công"

  /allocation-requests/{id}/cancel:
    patch:
      tags:
        - Allocation Request
      summary: Hủy yêu cầu
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "674f1111222233334444gggg"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                cancelReason:
                  type: string
                  example: "Đổi kế hoạch kinh doanh"
      responses:
        '200':
          description: Hủy thành công

  # ========== INVENTORY ==========
  /inventory:
    get:
      tags:
        - Inventory
      summary: Danh sách tồn kho
      description: Xem tồn kho của đại lý
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          example: 1
        - name: productId
          in: query
          schema:
            type: string
          description: Lọc theo sản phẩm
          example: "673b1111222233334444aaaa"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/InventoryResponse'

  /inventory/{productId}:
    get:
      tags:
        - Inventory
      summary: Tồn kho theo sản phẩm
      description: Lấy tồn kho của TẤT CẢ variants của 1 sản phẩm
      security:
        - BearerAuth: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
          description: ID của sản phẩm
          example: "673b1111222233334444aaaa"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      productId:
                        type: string
                        example: "673b1111222233334444aaaa"
                      productName:
                        type: string
                        example: "VinFast VF8"
                      totalStock:
                        type: integer
                        description: Tổng tồn kho tất cả variants
                        example: 45
                      totalReserved:
                        type: integer
                        description: Tổng số đã đặt chưa xuất
                        example: 8
                      variants:
                        type: array
                        items:
                          type: object
                          properties:
                            variantIndex:
                              type: integer
                              example: 0
                            attributeValue:
                              type: array
                              items:
                                type: string
                              example: ["Màu trắng", "Nội thất da nâu"]
                            stock:
                              type: integer
                              example: 15
                            reservedStock:
                              type: integer
                              example: 3
                            availableStock:
                              type: integer
                              example: 12

  # ========== PRICING & PROMOTION ==========
  /pricing:
    get:
      tags:
        - Pricing & Promotion
      summary: Danh sách giá sỉ
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PricingResponse'

  /pricing/discounts:
    get:
      tags:
        - Pricing & Promotion
      summary: Danh sách chiết khấu
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DiscountResponse'

  /pricing/promotions:
    get:
      tags:
        - Pricing & Promotion
      summary: Danh sách khuyến mãi
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PromotionResponse'

  /pricing/calculate:
    get:
      tags:
        - Pricing & Promotion
      summary: Tính giá cuối cùng
      description: Tính giá sau khi áp dụng chiết khấu và khuyến mãi
      security:
        - BearerAuth: []
      parameters:
        - name: productId
          in: query
          required: true
          schema:
            type: string
          example: "673b1111222233334444aaaa"
        - name: variantIndex
          in: query
          required: true
          schema:
            type: integer
          example: 0
        - name: quantity
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
          example: 10
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalculatePriceResponse'

  # ========== ORDERS ==========
  /orders:
    get:
      tags:
        - Orders
      summary: Danh sách đơn hàng
      description: Lấy danh sách đơn hàng của đại lý
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          example: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [draft, pending, confirmed, processing, delivering, completed, cancelled, refunded]
          description: Lọc theo trạng thái
          example: "pending"
        - name: keyword
          in: query
          schema:
            type: string
          description: Tìm kiếm theo mã đơn, tên/sđt/email khách hàng
          example: "Nguyễn Văn"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Lấy danh sách đơn hàng thành công!"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderListResponse'
                  pagination:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 45
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 20
                      totalPages:
                        type: integer
                        example: 3

    post:
      tags:
        - Orders
      summary: Tạo đơn hàng mới
      description: Tạo đơn hàng cho khách hàng (trạng thái draft)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
            example:
              customerInfo:
                fullName: "Nguyễn Văn An"
                phone: "0901234567"
                email: "nguyenvanan@gmail.com"
                address: "123 Nguyễn Huệ, Quận 1, TP.HCM"
              items:
                - productId: "673b1111222233334444aaaa"
                  variantIndex: 0
                  quantity: 2
                  discount: 5000000
                - productId: "673b2222333344445555bbbb"
                  variantIndex: 1
                  quantity: 1
                  discount: 0
              customerNotes: "Khách muốn nhận xe trước Tết"
              paymentMethod: "installment"
              shippingAddress:
                fullAddress: "456 Lê Lợi, Phường Bến Thành, Quận 1"
                city: "TP. Hồ Chí Minh"
                district: "Quận 1"
                ward: "Phường Bến Thành"
      responses:
        '201':
          description: Tạo đơn hàng thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Tạo đơn hàng thành công!"
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "675c1111222233334444eeee"
                      orderNumber:
                        type: string
                        example: "ORD-20250106-0123"
                      status:
                        type: string
                        example: "draft"
                      totalAmount:
                        type: number
                        example: 2050000000
        '400':
          description: Lỗi validation hoặc thiếu tồn kho
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Sản phẩm VinFast VF8 (Màu trắng, Nội thất da nâu) chỉ còn 5 xe!"

  /orders/{id}:
    get:
      tags:
        - Orders
      summary: Chi tiết đơn hàng
      description: Xem thông tin chi tiết 1 đơn hàng
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID đơn hàng
          example: "675c1111222233334444eeee"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Lấy thông tin đơn hàng thành công!"
                  data:
                    $ref: '#/components/schemas/OrderDetailResponse'

    patch:
      tags:
        - Orders
      summary: Cập nhật đơn hàng
      description: Cập nhật đơn hàng (chỉ khi trạng thái là draft)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "675c1111222233334444eeee"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/OrderItemRequest'
                customerNotes:
                  type: string
                dealerNotes:
                  type: string
                paymentMethod:
                  type: string
                  enum: [cash, bank_transfer, installment, other]
                shippingAddress:
                  type: object
                  properties:
                    fullAddress:
                      type: string
                    city:
                      type: string
                    district:
                      type: string
                    ward:
                      type: string
            example:
              items:
                - productId: "673b1111222233334444aaaa"
                  variantIndex: 0
                  quantity: 3
                  discount: 10000000
              dealerNotes: "Ưu tiên xử lý"
              paymentMethod: "bank_transfer"
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Cập nhật đơn hàng thành công!"
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "675c1111222233334444eeee"
                      orderNumber:
                        type: string
                        example: "ORD-20250106-0123"
                      status:
                        type: string
                        example: "draft"
                      totalAmount:
                        type: number
                        example: 3140000000
        '400':
          description: Không thể sửa đơn hàng
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Chỉ có thể sửa đơn hàng ở trạng thái 'draft'!"

    delete:
      tags:
        - Orders
      summary: Xóa đơn hàng
      description: Xóa đơn hàng (soft delete, chỉ khi trạng thái là draft)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "675c1111222233334444eeee"
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xóa đơn hàng thành công!"
        '400':
          description: Không thể xóa
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Chỉ có thể xóa đơn hàng ở trạng thái 'draft'!"

  /orders/{id}/submit:
    patch:
      tags:
        - Orders
      summary: Gửi đơn hàng
      description: Gửi đơn hàng (chuyển từ draft → pending). Hệ thống sẽ tự động reserve stock.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "675c1111222233334444eeee"
      responses:
        '200':
          description: Gửi đơn hàng thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Gửi đơn hàng thành công!"
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "675c1111222233334444eeee"
                      orderNumber:
                        type: string
                        example: "ORD-20250106-0123"
                      status:
                        type: string
                        example: "pending"
                      orderedAt:
                        type: string
                        format: date-time
                        example: "2025-01-06T10:30:00.000Z"
        '400':
          description: Không đủ tồn kho hoặc trạng thái không hợp lệ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Sản phẩm chỉ còn 2 xe!"

  /orders/{id}/confirm:
    patch:
      tags:
        - Orders
      summary: Xác nhận đơn hàng
      description: Xác nhận đơn hàng (chuyển từ pending → confirmed)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "675c1111222233334444eeee"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
                  description: Ghi chú khi xác nhận
            example:
              notes: "Đơn hàng đã được xác nhận, chuẩn bị xe"
      responses:
        '200':
          description: Xác nhận thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xác nhận đơn hàng thành công!"
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "675c1111222233334444eeee"
                      orderNumber:
                        type: string
                        example: "ORD-20250106-0123"
                      status:
                        type: string
                        example: "confirmed"
                      confirmedAt:
                        type: string
                        format: date-time
                        example: "2025-01-06T11:00:00.000Z"

  /orders/{id}/cancel:
    patch:
      tags:
        - Orders
      summary: Hủy đơn hàng
      description: Hủy đơn hàng. Hệ thống sẽ tự động giải phóng reserved stock.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "675c1111222233334444eeee"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: Lý do hủy đơn
            example:
              reason: "Khách hàng không còn nhu cầu"
      responses:
        '200':
          description: Hủy đơn hàng thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Hủy đơn hàng thành công!"
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "675c1111222233334444eeee"
                      orderNumber:
                        type: string
                        example: "ORD-20250106-0123"
                      status:
                        type: string
                        example: "cancelled"
                      cancelledAt:
                        type: string
                        format: date-time
                        example: "2025-01-06T14:30:00.000Z"
        '400':
          description: Không thể hủy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Không thể hủy đơn hàng ở trạng thái này!"

  /orders/{id}/history:
    get:
      tags:
        - Orders
      summary: Lịch sử đơn hàng
      description: Xem lịch sử thay đổi trạng thái của đơn hàng
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "675c1111222233334444eeee"
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Lấy lịch sử đơn hàng thành công!"
                  data:
                    $ref: '#/components/schemas/OrderHistoryResponse'


extends ../layouts/default.pug
include ../mixins/pagination.pug
include ../mixins/dealer-sidebar.pug

block main
  .row
    +dealer-sidebar(dealer, 'discount')
    .col-md-9.col-lg-10
      .card
        .card-header
          .row.align-items-center
            .col
              h4.card-title #{pageTitle}
              small.text-muted Đại lý: #{dealer.name} (#{dealer.code})
            .col-auto
              a.btn.btn-primary(
                href=`/${pathAdmin}/dealer/${dealer.id}/discount/create`
                )
                i.fa-solid.fa-plus.me-1
                | Thêm chiết khấu
              a.btn.btn-secondary.ms-2(
                href=`/${pathAdmin}/dealer/edit/${dealer.id}`
                )
                i.fa-solid.fa-arrow-left.me-1
                | Quay lại
        .card-body.pt-0
          .table-responsive
            table.table.table-striped.mb-0
              thead.table-light
                tr
                  th STT
                  th Tên chính sách
                  th Loại
                  th Giá trị
                  th Áp dụng cho
                  th Điều kiện
                  th Ngày hiệu lực
                  th Ngày hết hạn
                  th Trạng thái
                  th Ngày tạo
                  th.text-end Hành động
              tbody
                if discountList && discountList.length > 0
                  each item, index in discountList
                    tr
                      td #{pagination.skip + index + 1}
                      td
                        strong #{item.discountName || 'Không có tên'}
                      td
                        if item.discountType === "percentage"
                          span.badge.bg-info Phần trăm (%)
                        else
                          span.badge.bg-success Số tiền (đ)
                      td
                        if item.discountType === "percentage"
                          strong.text-success #{item.discountValue}%
                        else
                          strong.text-success #{item.discountValue.toLocaleString('vi-VN')} đ
                      td
                        if item.applyTo === "all_products"
                          span.badge.bg-primary Tất cả sản phẩm
                        else if item.applyTo === "specific_products"
                          if item.productIds && item.productIds.length > 0
                            | #{item.productIds.length} sản phẩm
                          else
                            span.text-muted Chưa chọn
                        else if item.applyTo === "product_category"
                          if item.categoryIds && item.categoryIds.length > 0
                            | #{item.categoryIds.length} danh mục
                          else
                            span.text-muted Chưa chọn
                      td
                        if item.minQuantity > 1
                          div Số lượng: ≥ #{item.minQuantity}
                        if item.minAmount > 0
                          div Tổng đơn: ≥ #{item.minAmount.toLocaleString('vi-VN')} đ
                        if item.minQuantity <= 1 && item.minAmount <= 0
                          span.text-muted Không có
                      td
                        | #{new Date(item.effectiveDate).toLocaleDateString('vi-VN')}
                      td
                        if item.expiryDate
                          | #{new Date(item.expiryDate).toLocaleDateString('vi-VN')}
                        else
                          span.text-muted Không giới hạn
                      td
                        if (item.status === "active")
                          span.badge.bg-success Hoạt động
                        else
                          span.badge.bg-secondary Tạm dừng
                      td
                        | #{new Date(item.createdAt).toLocaleDateString('vi-VN')}
                      td.text-end
                        a(href=`/${pathAdmin}/dealer/${dealer.id}/discount/detail/${item.id}` title="Xem chi tiết")
                          i.las.la-eye.text-info.font-16
                        a(href=`/${pathAdmin}/dealer/${dealer.id}/discount/edit/${item.id}` title="Chỉnh sửa" style="margin-left: 8px;")
                          i.las.la-pen.text-secondary.font-16
                        a(
                          href="javascript:;"
                          button-api=`delete-chiết khấu`
                          data-method="PATCH"
                          data-api=`/${pathAdmin}/dealer/${dealer.id}/discount/delete/${item.id}`
                          title="Xóa"
                          style="margin-left: 8px;"
                        )
                          i.las.la-trash-alt.text-secondary.font-16
                else
                  tr
                    td(colspan="11" class="text-center")
                      | Chưa có chính sách chiết khấu nào. 
                      a(href=`/${pathAdmin}/dealer/${dealer.id}/discount/create`) Thêm chiết khấu
          +pagination()

